# ============================================================
# AI Agent Configuration — copy to .env and fill in values
# ============================================================

# ── Required ──────────────────────────────────────────────────
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# ── Workspace ─────────────────────────────────────────────────
# Absolute path to the project the agent works in
AGENT_WORKSPACE=/absolute/path/to/your/project

# ── API Auth ──────────────────────────────────────────────────
# Protects the API and WebSocket. Generate: openssl rand -hex 32
AGENT_API_SECRET=

# ── Docker Sandbox ────────────────────────────────────────────
# true by default — all child processes run inside a container
# Set false only if Docker is unavailable
DOCKER_ENABLED=true

# ── Token Budget ──────────────────────────────────────────────
# Per-session token limit (input + output combined).
# Loop halts at 100%, warning fires at 80%.
# Default: 100,000 (~$1.50 at claude-opus-4-5 rates). Set to 0 to disable.
AGENT_TOKEN_BUDGET=100000

# ── Tool Call Limit ───────────────────────────────────────────
# Max tool calls per session. Catches stuck retry loops before
# they drain the token budget. Independent ceiling — whichever
# limit is hit first stops the loop. Set to 0 to disable.
AGENT_MAX_TOOL_CALLS=50

# ── Concurrent Sessions ────────────────────────────────────────
# Max number of sessions running the agentic loop simultaneously.
# Additional requests get a 429 until a slot frees up.
AGENT_MAX_CONCURRENT_SESSIONS=3

# ── CORS Origin ────────────────────────────────────────────────
# Allowed HTTP origin for API and WebSocket connections.
# Use your UI's actual origin. Use * only for local dev with no auth.
AGENT_CORS_ORIGIN=http://localhost:5173

# ── Prompt Size Limit ──────────────────────────────────────────
# Maximum prompt length in characters. Requests larger than this
# are rejected before they reach the API.
AGENT_MAX_PROMPT_CHARS=32000

# ── Trust Proxy ────────────────────────────────────────────────
# Configure Express trust proxy for correct IP detection behind
# reverse proxies, load balancers, or Docker networks.
# Values: 'false' (default), 'true', '1', '2', 'loopback', or IPs
# Required for rate limiting to work correctly behind a proxy.
AGENT_TRUST_PROXY=false

# ── Search Results Limit ───────────────────────────────────────
# Maximum results from searchInFiles tool. Prevents unbounded
# memory usage from broad regex matches on large codebases.
AGENT_MAX_SEARCH_RESULTS=500

# ── WebSocket Rate Limit ───────────────────────────────────────
# Maximum WebSocket events per socket per minute.
# Prevents clients from spamming the server via WebSocket.
AGENT_WS_RATE_LIMIT=30

# ── Graceful Shutdown ──────────────────────────────────────────
# Timeout in milliseconds for graceful shutdown. After this
# duration, the server force-terminates active connections.
AGENT_SHUTDOWN_TIMEOUT=30000

# ── Webhook Notifications ──────────────────────────────────────
# Optional URL to receive POST notifications when sessions complete.
# Useful for CI/CD integration or Slack notifications.
# AGENT_WEBHOOK_URL=https://your-webhook.example.com/agent-events

# ── Tool Result Storage ────────────────────────────────────────
# Maximum tool result size stored in database (bytes). Larger
# results are truncated. Full results are still sent in API responses.
AGENT_MAX_TOOL_RESULT_SIZE=10240

# ── Prometheus Metrics ─────────────────────────────────────────
# Enable /metrics endpoint for Prometheus scraping.
AGENT_METRICS_ENABLED=true

# ── Session TTL (Auto-Expiry) ─────────────────────────────────
# Sessions idle longer than this are automatically deleted.
# Value in milliseconds. Default: 86400000 (24 hours). Set to 0 to disable.
AGENT_SESSION_TTL=86400000

# ── Session Cleanup Interval ──────────────────────────────────
# How often to check for expired sessions.
# Value in milliseconds. Default: 300000 (5 minutes).
AGENT_SESSION_CLEANUP_INTERVAL=300000

# ── Patch Approval (Human-in-the-Loop) ─────────────────────────
# Require human approval before applying file patches.
# When true, shows a diff preview and waits for approval.
AGENT_REQUIRE_PATCH_APPROVAL=false

# ── API Retry Settings ────────────────────────────────────────
# Retry logic for transient API errors (429 rate limit, 500/503 server errors).
# These settings enable graceful recovery instead of immediate failure.
#
# Number of retry attempts for transient errors (0 to disable retries)
AGENT_API_RETRY_COUNT=3
# Initial delay between retries in ms (doubles with each retry)
AGENT_API_RETRY_DELAY=1000
# Maximum delay between retries in ms (caps exponential backoff)
AGENT_API_RETRY_MAX_DELAY=30000

# ── Tool Output Context Limit ─────────────────────────────────
# Maximum characters of tool output included in Claude's context.
# Large outputs (file listings, search results) are summarized to save tokens.
# Set to 0 for no limit (not recommended — can waste significant tokens).
AGENT_MAX_TOOL_OUTPUT_CONTEXT=8000

# ── Debug Mode ────────────────────────────────────────────────
# Logs full API requests/responses to debug-YYYY-MM-DD.log for troubleshooting.
# WARNING: This captures sensitive data including prompts. Use only for debugging.
AGENT_DEBUG_MODE=false

# ── Context Window ────────────────────────────────────────────
AGENT_MAX_CONTEXT_MESSAGES=30

# ── Model ─────────────────────────────────────────────────────
AGENT_MODEL=claude-opus-4-5
AGENT_MAX_TOKENS=8192
AGENT_MAX_RETRIES=3

# ── Server ────────────────────────────────────────────────────
PORT=3001

# ── Netlify Deploy (optional) ─────────────────────────────────
# NETLIFY_AUTH_TOKEN=
# NETLIFY_SITE_ID=

# ── Vercel Deploy (optional) ─────────────────────────────────
# Get your token from: https://vercel.com/account/tokens
# VERCEL_TOKEN=

# ── AWS Deploy (optional) ─────────────────────────────────────
# For S3 deployments and Terraform AWS resources.
# Create credentials at: https://console.aws.amazon.com/iam/
# These are read by AWS CLI/SDK directly from environment.
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_REGION=us-east-1

# ── Git Credentials (Docker mode only) ────────────────────────
# For git push/pull operations in Docker mode. Not needed for local mode
# since the agent inherits your host's git credentials.
#
# Format: https://username:token@github.com
# For GitHub: Create a Personal Access Token at https://github.com/settings/tokens
#             with 'repo' scope, then set:
#             GIT_CREDENTIALS=https://your-username:ghp_xxxxxxxxxxxx@github.com
#
# For GitLab: Create a token at https://gitlab.com/-/profile/personal_access_tokens
#             GIT_CREDENTIALS=https://your-username:glpat-xxxxxxxxxxxx@gitlab.com
#
# Optional: Override the git author identity used for commits
# GIT_CREDENTIALS=
# GIT_USER_EMAIL=you@example.com
# GIT_USER_NAME=Your Name

# ── Logging ───────────────────────────────────────────────────
LOG_LEVEL=info

# ── Note: ALLOWED_COMMANDS has been removed ───────────────────
# The agent no longer has a raw shell tool. Every operation
# is a typed handler (npm_install, npm_run, tsc_check, etc.)
# with hardcoded binaries. There is nothing to allowlist.
